<div class="container">
 <h3> <%= @conversation.subject %></h3>
 <div class="spacer"></div>
<div class="panel panel-default">
  <div class="panel-heading">
    Conversation with <%= participant_names(@conversation) %> 
    <% if current_user.is_expert? %>
      <div id="invoice-modal" class="pull-right">
        <button type="button" class="button-link" data-toggle="modal" data-target="#invoiceModal">
            Send Invoice
        </button>
      </div>
    <% end %>
  </div>
  <div class="panel-body">
    <div class="messages">
      <% @conversation.receipts_for(current_user).reverse.each do |receipt| %>
        <div class="media">
          <% message = receipt.message %>
 
          <div class="media-body">
            <h6 class="media-heading"><b><%= message.sender.name %></b>
              says at <%= message.created_at.strftime("%-d %B %Y, %H:%M") %></h6>
            <%= message.body %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<% if @respondable %>
  <%= form_tag reply_conversation_path(@conversation), method: :post do %>
    <div class="form-group">
      <%= text_area_tag 'body', nil, cols: 3, class: 'form-control', placeholder: 'Type something...', required: true %>
    </div>
    <%= submit_tag "Send Message", class: 'btn btn-primary' %>
  <% end %>
  <% else %>
  <%= image_tag('locked-message.jpg', :class=>"img-responsive", :style=>"min-height:75px;") %>
  <div class="bg-danger stripe-warning">
    You must <%= link_to 'Connect with Stripe', user_omniauth_authorize_path(:stripe_connect) %> before you can respond to customers
  </div>
<% end %>


<br><br>

 <div class="modal fade" id="invoiceModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4>New Invoice</h4>
      </div>
      <%= render :template => new_job_path, :locals=>{:conversation=> @conversation} %>

    </div>
  </div>
</div>